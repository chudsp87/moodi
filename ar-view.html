<!DOCTYPE html>
<html>

<head>
    <title>Page Title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="styles/style.css" rel="stylesheet" />
    <link href="styles/buttons.css" rel="stylesheet" />
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <style>
        body {
        font-family: "Varela Round", sans-serif;
        margin: 0;
        width: 100%;
    }

    </style>
    <link href="./color-wheel/color-wheel.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.1.0/es6-promise.auto.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="./color-wheel/d3-sunburst-menu-master/d3-sunburst-menu-master/src/d3-sunburst-menu.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <!-- Header -->
    <div id="header"></div>
    
    <!-- The flexible grid (content) -->
    <div class="row">
        <div id="sidenav"></div>
        
        <div class="main" style="padding: 1em 7em 1em 2em;">
            <div class="flex-1">
                
                <!-- <div class="basic-text-page" style="padding: 1em 7em 1em 2em;"> -->
                <h1 style=>Preview AR View</h1>
            </div>
            <div class="flex-2">
                <div class="wrapper">
                    
                    <img src="images/glow-preview/color-glow-base.png" alt="Base Image" class="base-image">
                    <img src="images/glow-preview/red-glow.png" alt="Overlay 1" class="overlay" id="img-overlay">

                </div>
            </div>
            <div class="flex-3">
                <button class="button moodbtn" mood='happy'>Happy</button>
                <button class="button moodbtn" mood='sad'>Sad</button>
                <button class="button moodbtn" mood='surprise'>Surprised</button>
                <button class="button moodbtn" mood='amazed'>Amazed</button>
            </div>
            <div id="mood-settings"></div>
            
        </div>
    </div>
    <!-- Footer -->
    <div id="footer"></div>

    <script>
        $(document).ready(function() {
            $("#header").load("components/header.html");
            $("#sidenav").load("components/sidenav.html");
            $("#footer").load("components/footer.html");
            // $("#bottom-buttons").load("components/bottom-buttons.html");
        });
    </script>
    <script>
        /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
        var dropdown = document.getElementsByClassName("dropdown-btn");
        var i;

        for (i = 0; i < dropdown.length; i++) {
            dropdown[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
            });
        }
    </script>

    <script>
    /* Add click event listener to dropdown container elements */
    // document.querySelectorAll("div.dropdown-container > a").forEach(function(element) {
    document.querySelectorAll("div.sidenav > a, div.dropdown-container > a").forEach(function(element) {
        element.addEventListener('click', function(event) {
            // Remove the active-dropdown class from all dropdown container elements
            document.querySelectorAll('div.sidenav > a, .dropdown-container a').forEach(function(el) {
                el.classList.remove('active-dropdown');
            });

            // Add the active-dropdown class to the clicked element
            event.target.classList.add('active-dropdown');
        });
    });
    </script>
    </body>
</html>


<script type="module">

    import ColorWheel from "./color-wheel/color-wheel.js";

    let domElem = document.getElementById("mood-settings");

    if (window["MOODI"] === undefined)
    {
        window.MOODI = {}
    }

    let r = await fetch("./color-wheel/color-wheel.json");
    let json = await r.json();

    json["name"] = "others";

    let cw = new ColorWheel({visible:false, colorWheelConfig:json});

    let html = await cw.generateHTML();

    // Fill in buttons
    Object.values(document.getElementsByClassName("moodbtn")).forEach(btn=>{
        let mood = btn.getAttribute("mood");
        btn.style.background = window.MOODI.getEmotionColor("others", mood);
        btn.addEventListener("click", ()=>window.toggleOverlay(btn));
    })

    window.toggleOverlay = function(btn) {

        console.log("s")
        let mood = btn.getAttribute("mood");
        
        let color = window.MOODI.getEmotionColor("others", mood);
        // Ensure not a normal color
        d = document.createElement("div");
        d.style.color = color;
        document.body.appendChild(d)
        //Color in RGB 
        let rgb = window.getComputedStyle(d).color;
        document.body.removeChild(d);
        // let hex = "#" + /rgb\([\d]+, [\d]+, [\d]+\)/i.exec(rgb);
        let tmp = rgb.substring(4,rgb.length-1).split(", ");
        let hex = "#" + parseInt(tmp[0]).toString(16).padStart(2, "0") + parseInt(tmp[1]).toString(16).padStart(2, "0") + parseInt(tmp[2]).toString(16).padStart(2, "0");

        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);

        var r = parseInt(result[1], 16);
        var g = parseInt(result[2], 16);
        var b = parseInt(result[3], 16);

        r /= 255, g /= 255, b /= 255;
        var max = Math.max(r, g, b), min = Math.min(r, g, b);
        var h, s, l = (max + min) / 2;

        if(max == min){
            h = s = 0; // achromatic
        } else {
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }

        s = s*100;
        s = Math.round(s);
        l = l*100;
        l = Math.round(l);
        h = Math.round(360*h);

        var colorInHSL = 'hsl(' + h + ', ' + s + '%, ' + l + '%)';
        // $rootScope.$emit('colorChanged', {colorInHSL});

        // document.getElementById("img-overlay").style.filter = ` hue-rotate(${h}deg) saturate(${s}%) brightness(${l}%)`;

        document.getElementById("img-overlay").style.filter = ` brightness(3) saturate(10) hue-rotate(${h}deg)`;
    }


    let wrap = document.createElement("div");
    wrap.style.display = "none";

    domElem.appendChild(wrap);

    window.MOODI.primary = cw;
    wrap.appendChild(html);
</script>
