<!DOCTYPE html>
<html>

<head>
    <title>Page Title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="styles/style.css" rel="stylesheet" />
    <link href="styles/buttons.css" rel="stylesheet" />
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <style>
        body {
        font-family: "Varela Round", sans-serif;
        margin: 0;
        width: 100%;
    }

    </style>
    <link href="./color-wheel/color-wheel.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.1.0/es6-promise.auto.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="./color-wheel/d3-sunburst-menu-master/d3-sunburst-menu-master/src/d3-sunburst-menu.js" type="text/javascript" charset="utf-8"></script>

<body>
    <!-- Header -->
    <div class="header">
        <!-- <h1>My Website</h1> -->
        <a style="margin-top: 1rem" href="index.html">
            <img id="logo" src="images/logo/moodi-logo-final.svg" />
        </a>
        <p><em>Moodi tagline</em></p>
    </div>
    <!-- Navigation Bar -->
    <!-- <div class="navbar">
        <a class="active" href="moodi-flex-style.html">Home</a>
        <a href="#">Link</a>
        <a href="#">Link</a>
        <a href="#">Link</a>
    </div> -->
    <!-- The flexible grid (content) -->
    <div class="row">
        <div class="side">
            <div class="sidenav">
                <a href="index.html">Home</a>
                <a href="#devices">Devices</a>
                <!-- <button class="dropdown-btn">Mood Settings
                    <i class="fa fa-caret-down"></i>
                </button>
                <div class="dropdown-container">
                    <a href="#">Happiness</a>
                    <a href="#">Surprise</a>
                    <a href="#">Sadness</a>
                    <a href="#">Anger</a>
                    <a href="#">Fear</a>
                    <a href="#">Disgust</a>
                </div> -->
                <a href="mood-settings.html">Mood Settings</a>
                <a href="#sharing">Sharing/Privacy</a>
                <a href="#history">History/Mapping</a>
                <a href="ar-view.html">AR View (needed?)</a>
                <button class="dropdown-btn">Dropdown
                    <i class="fa fa-caret-down"></i>
                </button>
                <div class="dropdown-container">
                    <a href="#">Link 1</a>
                    <a href="#">Link 2</a>
                    <a href="#">Link 3</a>
                </div>
            </div>
        </div>
        <div class="main" style="padding: 1em 7em 1em 2em;">
            <div class="flex-1">
                
                <!-- <div class="basic-text-page" style="padding: 1em 7em 1em 2em;"> -->
                <h1 style=>Preview AR View</h1>
            </div>
            <div class="flex-2">
                <div class="wrapper">
                    <!-- <img src="images/glow-preview/color-glow-base.png" alt="Base Image" class="base-image"> -->
                    <img src="images/glow-preview/color-glow-base.png" alt="Base Image" class="base-image">
                    <img src="images/glow-preview/red-glow.png" alt="Overlay 1" class="overlay" id="img-overlay">
                    <!-- <img src="images/glow-preview/red-glow.png" alt="Overlay 1" class="overlay" id="red-overlay">
                    <img src="images/glow-preview/orange-glow.png" alt="Overlay 2" class="overlay" id="orange-overlay">
                    <img src="images/glow-preview/yellow-glow.png" alt="Overlay 3" class="overlay" id="yellow-overlay">
                    <img src="images/glow-preview/lime-green-glow.png" alt="Overlay 1" class="overlay" id="lime-green-overlay">
                    <img src="images/glow-preview/green-glow.png" alt="Overlay 1" class="overlay" id="green-overlay">
                    <img src="images/glow-preview/cyan-glow.png" alt="Overlay 2" class="overlay" id="cyan-overlay">
                    <img src="images/glow-preview/blue-glow.png" alt="Overlay 3" class="overlay" id="blue-overlay">
                    <img src="images/glow-preview/purple-glow.png" alt="Overlay 1" class="overlay" id="purple-overlay">
                    <img src="images/glow-preview/pink-glow.png" alt="Overlay 2" class="overlay" id="pink-overlay"> -->
                </div>
            </div>
            <div class="flex-3">
                <button class="button moodbtn" mood='happy'>Happy</button>
                <button class="button moodbtn" mood='sad'>Sad</button>
                <button class="button moodbtn" mood='surprise'>Surprised</button>
                <button class="button moodbtn" mood='amazed'>Amazed</button>
            </div>
            <div id="mood-settings"></div>
            <!-- <div class="fakeimg" style="height:200px;">Image</div>
            <p>Some text..</p>
            <p>Sunt in culpa qui officia deserunt mollit anim id est laborum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco.</p>
            <br>
            <h2>TITLE HEADING</h2>
            <h5>Title description, Sep 2, 2017</h5>
            <div class="fakeimg" style="height:200px;">Image</div>
            <p>Some text..</p>
            <p>Sunt in culpa qui officia deserunt mollit anim id est laborum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco.</p> -->
        </div>
    </div>
    <!-- Footer -->
    <div class="footer">
        <h2>Footer</h2>
    </div>
    <script>
    /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
    var dropdown = document.getElementsByClassName("dropdown-btn");
    var i;

    for (i = 0; i < dropdown.length; i++) {
        dropdown[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var dropdownContent = this.nextElementSibling;
            if (dropdownContent.style.display === "block") {
                dropdownContent.style.display = "none";
            } else {
                dropdownContent.style.display = "block";
            }
        });
    }
    </script>
    <script>
    /* Add click event listener to dropdown container elements */
    // document.querySelectorAll("div.dropdown-container > a").forEach(function(element) {
    document.querySelectorAll("div.sidenav > a, div.dropdown-container > a").forEach(function(element) {
        element.addEventListener('click', function(event) {
            // Remove the active-dropdown class from all dropdown container elements
            document.querySelectorAll('div.sidenav > a, .dropdown-container a').forEach(function(el) {
                el.classList.remove('active-dropdown');
            });

            // Add the active-dropdown class to the clicked element
            event.target.classList.add('active-dropdown');
        });
    });
    </script>
    <script type="text/javascript">
    $(function() {
        $("div.sidenav > a, div.dropdown-container > a").click(function() {
            $.get("#");

            return false; // prevent default browser refresh on "#" link
        });
    });
    </script>
</body>

</html>

<script type="module">

    import ColorWheel from "./color-wheel/color-wheel.js";

    let domElem = document.getElementById("mood-settings");

    if (window["MOODI"] === undefined)
    {
        window.MOODI = {}
    }

    let r = await fetch("/color-wheel/color-wheel.json");
    let json = await r.json();

    json["name"] = "others";

    let cw = new ColorWheel({visible:false, colorWheelConfig:json});

    let html = await cw.generateHTML();

    // Fill in buttons
    Object.values(document.getElementsByClassName("moodbtn")).forEach(btn=>{
        let mood = btn.getAttribute("mood");
        btn.style.background = window.MOODI.getEmotionColor("others", mood);
        btn.addEventListener("click", ()=>window.toggleOverlay(btn));
    })

    window.toggleOverlay = function(btn) {

        console.log("s")
        let mood = btn.getAttribute("mood");
        
        let color = window.MOODI.getEmotionColor("others", mood);
        // Ensure not a normal color
        d = document.createElement("div");
        d.style.color = color;
        document.body.appendChild(d)
        //Color in RGB 
        let rgb = window.getComputedStyle(d).color;
        document.body.removeChild(d);
        console.log(rgb)
        // let hex = "#" + /rgb\([\d]+, [\d]+, [\d]+\)/i.exec(rgb);
        let tmp = rgb.substring(4,rgb.length-1).split(", ");
        let hex = "#" + parseInt(tmp[0]).toString(16).padStart(2, "0") + parseInt(tmp[1]).toString(16).padStart(2, "0") + parseInt(tmp[2]).toString(16).padStart(2, "0");
        console.log(hex)

        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);

        var r = parseInt(result[1], 16);
        var g = parseInt(result[2], 16);
        var b = parseInt(result[3], 16);

        r /= 255, g /= 255, b /= 255;
        var max = Math.max(r, g, b), min = Math.min(r, g, b);
        var h, s, l = (max + min) / 2;

        if(max == min){
            h = s = 0; // achromatic
        } else {
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }

        s = s*100;
        s = Math.round(s);
        l = l*100;
        l = Math.round(l);
        h = Math.round(360*h);

        var colorInHSL = 'hsl(' + h + ', ' + s + '%, ' + l + '%)';
        // $rootScope.$emit('colorChanged', {colorInHSL});

        
        document.getElementById("img-overlay").style.filter = ` sepia(0.1) brightness(5) hue-rotate(${h}deg) saturate(${s}%) brightness(${l}%)`;
    }


    let wrap = document.createElement("div");
    wrap.style.display = "none";

    domElem.appendChild(wrap);

    window.MOODI.primary = cw;
    wrap.appendChild(html);
</script>
